<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="UTF-8"/>
		<title>图片分割</title>
		<style type="text/css">
			#main{
				margin: auto;
			}
			*{
				transition: all 0.5s;
			}
			.splitImg{
				float: left;
				/*display: inline-block;*/
				background-repeat: no-repeat;
			}
			.imgBr{
				clear: left;
			}
			.split{
				margin: 3px;
				border-radius: 5px;
			}
		</style>
		<script type="text/javascript">
			var imgPath = "img.jpg";
			var imgWidth = 540
			var imgHeight = 539
			var splitCount = 6;//切割份数
			var splitWidth = imgWidth / splitCount;
			var splitHeight = imgHeight / splitCount;
			function $(id){
				return document.getElementById(id);
			}
			function $splitImg(index){
				var divs = document.getElementsByClassName("splitImg");
				for (var i = 0; i < divs.length; i++) {
					if (divs[i].getAttribute("index") == index) {
						return divs[i];
					}
				}
			}
			function splitImgExchange(originIndex,aimsIndex){//替换两个DIV背景图片的位置
				var originElement = $splitImg(originIndex);
				var origenPosition = originElement.style["background-position"];
				var aimsEelement = $splitImg(aimsIndex);

				originElement.style["background-position"] = aimsEelement.style["background-position"];
				aimsEelement.style["background-position"] = origenPosition;
				//替换两个Index值
				originElement.setAttribute("index",aimsIndex);
				aimsEelement.setAttribute("index",originIndex);
			}
			function isWin(){
				var divs = document.getElementsByClassName("splitImg");
				for (var i = 0; i < divs.length; i++) {
					if(divs[i].getAttribute("index") != i+1)
						return false;
				}
				return true;
			}
			function myRegDrag(element){
				element.ondragstart = function(event){
					event.dataTransfer.setData("originIndex",this.getAttribute("index"));
				}

				element.ondragover = function(event){
					event.preventDefault();
				}
				element.ondragleave = function(event){
					event.preventDefault();
				}
				element.ondrop = function(event){
					event.preventDefault();
					var originIndex = event.dataTransfer.getData("originIndex");

					splitImgExchange(originIndex,this.getAttribute("index"));
					if(isWin()){
						changeShow();
						alert("恭喜！你赢了！");
					}
				}
			}
			function myCreateImg(img,left,top){
				var div = document.createElement("div");
				div.style["background-image"] = "url("+img+")"
				div.style["width"] = splitWidth + "px";
				div.style["height"] = splitHeight + "px";

				div.draggable = true;
				myRegDrag(div);

				if(top == undefined){
					top = 0;
				}
				if(left == undefined){
					left = 0;
				}
				div.style["background-position"] = -left + "px " + -top + "px";

				div.classList.add("splitImg");
				return div;
			}
			function RandomNumBoth(Min,Max){
			      var Range = Max - Min;
			      var Rand = Math.random();
			      var num = Min + Math.round(Rand * Range); //四舍五入
			      return num;
			}
			//随机图片的位置
			function randSplitIndex(){
				var min = 1;
				var max = Math.pow(splitCount,2);
				for (var i = 0; i < max; i++) {
					var originIndex = RandomNumBoth(min,max);
					var aimsIndex = RandomNumBoth(min,max);
					splitImgExchange(originIndex,aimsIndex);
				}
			}

			window.onload = function(){
				$("main").style["width"] = imgWidth + splitCount*2*3 + "px";
				$("main").style["height"] = imgHeight + splitCount*2*3 + "px";

				var isNewline = false;
				var row = 0;
				var col = 0;
				for (var i = 1; i <= Math.pow(splitCount,2); i++) {
					var div = myCreateImg(imgPath,col*splitWidth,row*splitHeight);
					div.setAttribute("index",i);
					if(isNewline){//换行
						isNewline = false;
						div.classList.add("imgBr");
					}

					col++;
					if(i % splitCount == 0){
						isNewline = true;
						row++;
						col = 0;
					}
					$("main").appendChild(div);
				}

				randSplitIndex();
				changeShow();
			}
			var showType = false;
			function changeShow(event){
				showType = !showType;
				var divs = document.getElementsByClassName("splitImg");
				for (var i = 0; i < divs.length; i++) {
					if(showType)
						divs[i].classList.add("split");
					else
						divs[i].classList.remove("split");
				}
			}
		</script>
	</head>
	<body>
		<div id="main" onclick=""></div>
	</body>
</html>